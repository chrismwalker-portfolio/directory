"use strict";$(document).ready(function(){function l(e){var r=e.action,t=e.errorType,n=void 0===t?"undefinedError":t,o=void 0===(e=e.data)?{}:e;return new Promise(function(t,a){$.ajax({type:"POST",url:"resources/php/"+r+".php",data:o,dataType:"json",success:function(e){if("OK"==e.status.name){switch(r){case"getAll":case"searchAllPersonnel":d(e),$(".modal").modal("hide"),c($("#personnel-table-wrapper")),$("#maintenance-nav").find(".active").removeClass("active"),$("#personnel-nav-link").addClass("active");break;case"insertUpdatePersonnel":case"deletePersonnelByID":p(e.status.description),$("#personnel-search-input").val()?$("#search-personnel-form").submit():l({action:"getAll",errorType:"getAllError"}).catch(function(e){i.raiseError(e)});break;case"insertUpdateDepartment":case"deleteDepartmentByID":case"insertUpdateLocation":case"deleteLocationByID":p(e.status.description),(0<=r.indexOf("Department")?$("#departments-nav-link"):$("#locations-nav-link")).trigger("click")}t(e)}else a(e)},error:function(e){a(new Error(i[n]))}})})}function o(e){$("#departments-table tbody").find("tr").remove(),$.each(e.data.departments,function(e,t){$("#departments-table tbody").append("<tr data-id="+t.id+'>\n                    <td class="department-name">'+t.name+'</td>\n                    <td class="department-location d-none d-lg-table-cell">'+t.location+'</td>\n                    <td class="td-icon text-end"><i class="departments fas fa-minus-circle" data-bs-toggle="tooltip" data-bs-placement="left" data-bs-offset="0,10" data-bs-custom-class="tt-delete" title="Delete '+t.name+'"></td>\n                </tr>')}),t(e.data.departments.length,e.data.count,e.data.departments.length<1)}function s(e){$("#locations-table tbody").find("tr").remove(),$.each(e.data.locations,function(e,t){$("#locations-table tbody").append("<tr data-id="+t.id+'>\n                    <td class="location-name">'+t.name+'</td>\n                    <td class="td-icon text-end"><i class="locations fas fa-minus-circle" data-bs-toggle="tooltip" data-bs-placement="left" data-bs-offset="0,10" data-bs-custom-class="tt-delete" title="Delete '+t.name+'"></td>\n                </tr>')}),t(e.data.locations.length,e.data.count,e.data.locations.length<1)}var i={getAllError:"Unable to retrieve personnel list from the database",searchAllPersonnelError:"Unable to search for personnel in the database",getAllDepartmentsError:"Unable to retrieve department list from the database",getAllLocationsError:"Unable to retrieve location list from the database",getPersonnelByIDError:"Unable to retrieve personnel record from the database",getDepartmentByIDError:"Unable to retrieve department from the database",getLocationByIDError:"Unable to retrieve location from the database",getFKRecordsError:"Unable to retrieve list of attached records from the database",insertUpdatePersonnelError:"Unable to save personnel data to the database",insertUpdateDepartmentError:"Unable to save department to the database",insertUpdateLocationError:"Unable to save location to the database",deletePersonnelByIDError:"Unable to delete personnel record from the database",deleteDepartmentByIDError:"Unable to delete department from the database",deleteLocationByIDError:"Unable to delete location from the database",undefinedError:"An error occurred",raiseError:function(e){$("#error-description").text("").addClass("hide"),e instanceof Error?$("#error-description").text(e.message).removeClass("hide"):e.status.description&&$("#error-description").html(e.status.description).removeClass("hide"),$(".modal").modal("hide"),$("#errorModal").modal("show"),r()}},d=function(e){$("#personnel-table tbody").find("tr").remove(),$.each(e.data.personnel,function(e,t){$("#personnel-table tbody").append("<tr data-id="+t.id+'>\n                    <th scope="row" class="person-id d-none d-lg-table-cell">'+t.id+'</th>\n                    <td class="person-name"><strong>'+t.lastName+"</strong>, "+t.firstName+'</td>\n                    <td class="person-email d-none d-lg-table-cell">'+t.email+'</td>\n                    <td class="person-department d-none d-lg-table-cell">'+t.department+'</td>\n                    <td class="person-location d-none d-lg-table-cell">'+t.location+'</td>\n                    <td class="person-job-title d-none d-lg-table-cell">'+t.jobTitle+'</td>\n                    <td class="td-icon text-end"><i class="personnel fas fa-minus-circle" data-bs-toggle="tooltip" data-bs-placement="left" data-bs-offset="0,10" data-bs-custom-class="tt-delete" title="Delete '+t.lastName+", "+t.firstName+'"></td>\n                </tr>')}),t(e.data.personnel.length,e.data.count,e.data.personnel.length<1)},t=function(e,t,a){$("#personnel-row-count").text("Displaying "+e+" of "+t+" records"),a&&$("#searchNoMatchModal").modal("show")},c=function(e){switch($(".table-wrapper").addClass("hide"),$(e).removeClass("hide"),$(e).attr("id")){case"personnel-table-wrapper":$("#add-record-icon-fixed").attr("title","Add Personnel");break;case"departments-table-wrapper":$("#add-record-icon-fixed").attr("title","Add Department");break;case"locations-table-wrapper":$("#add-record-icon-fixed").attr("title","Add Location");break;default:i.raiseError(new Error(i.undefinedError))}a()},p=function(e){$("#success-toast-text").text(e),$("#successToast").toast("show")},a=function(){"ontouchstart"in window||[].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]')).map(function(e){return new bootstrap.Tooltip(e)})},r=function(){$("#preloader").fadeOut("fast",function(){$("#preloader").removeClass("preloader-init")})};$(document).on("ajaxStart",function(){$("#preloader").show()}).on("ajaxComplete",function(){r()}),$(".main-row").on("scroll",function(){50<$(".main-row").scrollTop()&&!$(".main-row").hasClass(".icon-fixed-grow")?$(".icon-fixed").addClass("icon-fixed-grow"):$(".main-row").scrollTop()<=50&&$(".icon-fixed").removeClass("icon-fixed-grow")}),$("#backtop-icon-fixed").on("click",function(){$(".tooltip").tooltip("hide"),$(".main-row").animate({scrollTop:0},"fast")}),$(".sort").on("click",function(){var t=this,a=$(this).closest("table").attr("id"),e={},r=$(this).attr("id").substr($(this).attr("id").lastIndexOf("-")+1,$(this).attr("id").length);switch(a){case"personnel-table":r="lastName"===r?r+" "+$(this).attr("data-sort")+", department, location":r+" "+$(this).attr("data-sort")+", lastName",e={action:"getAll",errorType:"gettAllError"};break;case"departments-table":r="location"===r?r+" "+$(this).attr("data-sort")+", name":r+" "+$(this).attr("data-sort")+", location",e={action:"getAllDepartments",errorType:"getAllDepartmentsError"};break;case"locations-table":r=r+" "+$(this).attr("data-sort"),e={action:"getAllLocations",errorType:"getAllLocationsError"};break;default:i.raiseError(new Error(i.undefinedError))}"personnel-table"===a&&$("#personnel-search-input").val()?l({action:"searchAllPersonnel",errorType:"searchAllPersonnelError",data:{search:$("#personnel-search-input").val(),orderBy:r}}).catch(function(e){i.raiseError(e)}):l({action:e.action,errorType:e.errorType,data:{orderBy:r}}).then(function(e){"departments-table"!==a&&"locations-table"!==a||("departments-table"===a?o(e):"locations-table"===a&&s(e),c($(t).closest(".table-wrapper")))}).catch(function(e){i.raiseError(e)});var n="ASC"===$(this).attr("data-sort")?"DESC":"ASC";$(this).attr("data-sort",n),$(".tooltip").tooltip("hide")}),$(".table-wrapper").on("click","tr",function(e){var t,a=$(this).closest(".table-wrapper").attr("id").substr(0,$(this).closest(".table-wrapper").attr("id").indexOf("-")),r={};if($.inArray("fas",e.target.classList)<0&&"thead"!==e.currentTarget.parentElement.nodeName.toLowerCase()){switch(a){case"personnel":r={form:$("#personnel-form")[0],dropdown:$("#personnel-department").children(),modal:$("#personnelModal"),action:"getPersonnelByID",errorType:"getPersonnelByIDError"};break;case"departments":r={form:$("#department-form")[0],dropdown:$("#department-location").children(),modal:$("#departmentModal"),action:"getDepartmentByID",errorType:"getDepartmentByIDError"};break;case"locations":r={form:$("#location-form")[0],modal:$("#locationModal"),action:"getLocationByID",errorType:"getLocationByIDError"};break;default:i.raiseError(new Error(i.undefinedError))}r.form.reset(),"dropdown"in r&&r.dropdown.remove(),l({action:r.action,errorType:r.errorType,data:{id:$(this).attr("data-id")}}).then(function(e){switch(a){case"personnel":$.each(e.data.department,function(e,t){$("#personnel-department").append($("<option></option>").attr({value:t.id,"data-location":t.location}).text($.parseHTML(t.name)[0].textContent))}),$("#update-personnel-id").val(e.data.personnel[0].id),e.data.personnel[0].firstName&&e.data.personnel[0].lastName&&($("#update-personnel-name").val($.parseHTML(e.data.personnel[0].lastName)[0].textContent+", "+$.parseHTML(e.data.personnel[0].firstName)[0].textContent),r.modalTitleText=$("#update-personnel-name").val()),e.data.personnel[0].firstName&&$("#personnel-first-name").val($.parseHTML(e.data.personnel[0].firstName)[0].textContent),e.data.personnel[0].lastName&&$("#personnel-last-name").val($.parseHTML(e.data.personnel[0].lastName)[0].textContent),e.data.personnel[0].email&&$("#personnel-email").val($.parseHTML(e.data.personnel[0].email)[0].textContent),$("#personnel-department").val(e.data.personnel[0].departmentID),$("#personnel-location").val($.parseHTML($("#personnel-department option:selected").attr("data-location"))[0].textContent),e.data.personnel[0].jobTitle&&$("#personnel-job-title").val($.parseHTML(e.data.personnel[0].jobTitle)[0].textContent);break;case"departments":$.each(e.data.locations,function(e,t){$("#department-location").append($("<option></option>").attr({value:t.id}).text($.parseHTML(t.name)[0].textContent))}),$("#update-department-id").val(e.data.department[0].id),e.data.department[0].name&&($("#update-department-name").val($.parseHTML(e.data.department[0].name)[0].textContent),r.modalTitleText=$("#update-department-name").val()),e.data.department[0].name&&$("#department-name").val($.parseHTML(e.data.department[0].name)[0].textContent),$("#department-location").val(e.data.department[0].locationID);break;case"locations":$("#update-location-id").val(e.data.location[0].id),e.data.location[0].name&&($("#update-location-name").val($.parseHTML(e.data.location[0].name)[0].textContent),r.modalTitleText=$("#update-location-name").val()),e.data.location[0].name&&$("#location-name").val($.parseHTML(e.data.location[0].name)[0].textContent);break;default:i.raiseError(new Error(i.undefinedError))}$(".modal-title-add-record").addClass("hide"),$(".modal-title-update-record").text("Edit "+r.modalTitleText).removeClass("hide"),$(".btn-save").text("Update"),r.modal.modal("show")}).catch(function(e){i.raiseError(e)})}else 0<$.inArray("fas",e.target.classList)&&"thead"!==e.currentTarget.parentElement.nodeName.toLowerCase()&&(e=t=void 0,"personnel"===a?(t="deletePersonnelByID",e=$(this).find(".person-name").text()):"departments"===a?(t="deleteDepartmentByID",e=$(this).find(".department-name").text()):"locations"===a&&(t="deleteLocationByID",e=$(this).find(".location-name").text()),$("#confirm-yes").attr({"data-action":t,"data-id":$(this).attr("data-id")}),$("#confirm-modal-title").text("Delete "+e),$("#confirmModal").modal("show"))}),$(".td-icon").add("#add-record-icon-fixed").on("click",function(){$(".modal-title-update-record").addClass("hide"),$(".modal-title-add-record").removeClass("hide"),$(".btn-save").text("Save"),$("#personnel-table-wrapper").hasClass("hide")?$("#departments-table-wrapper").hasClass("hide")?$("#locations-table-wrapper").hasClass("hide")||($("#location-form")[0].reset(),$("#locationModal").modal("show")):($("#department-form")[0].reset(),$("#department-location").children().remove(),l({action:"getAllLocations",errorType:"getAllLocationsError"}).then(function(e){$.each(e.data.locations,function(e,t){$("#department-location").append($("<option></option>").attr({value:t.id}).text($.parseHTML(t.name)[0].textContent))}),$("#departmentModal").modal("show")}).catch(function(e){i.raiseError(e)})):($("#personnel-form")[0].reset(),$("#personnel-department").children().remove(),l({action:"getAllDepartments",errorType:"getAllDepartmentsError"}).then(function(e){$.each(e.data.departments,function(e,t){$("#personnel-department").append($("<option></option>").attr({value:t.id,"data-location":t.location}).text($.parseHTML(t.name)[0].textContent))}),$("#personnel-location").val($.parseHTML($("#personnel-department option:selected").attr("data-location"))[0].textContent),$("#personnelModal").modal("show")}).catch(function(e){i.raiseError(e)}))}),$(".modal").on("shown.bs.modal",function(){$(".tooltip").tooltip("hide"),$(".icon-fixed").removeClass("icon-fixed-grow"),$("form :input:enabled:visible:first",this).focus()}),$(".modal").on("hidden.bs.modal",function(){50<$(".main-row").scrollTop()&&$(".icon-fixed").addClass("icon-fixed-grow")}),$("#personnel-form").add("#department-form").add("#location-form").on("submit",function(e){e.preventDefault();var t={};switch(e=$(this).closest(".modal").attr("id"),$("#confirm-no").add("#confirm-close").attr("data-bs-toggle","modal").attr("data-bs-target","#"+e),$(this).attr("id").substr(0,$(this).attr("id").indexOf("-"))){case"personnel":t={action:"insertUpdatePersonnel",addTitle:$("#personnel-last-name").val()+", "+$("#personnel-first-name").val(),updateTitle:$("#update-personnel-name").val()};break;case"department":t={action:"insertUpdateDepartment",addTitle:$("#department-name").val(),updateTitle:$("#update-department-name").val()};break;case"location":t={action:"insertUpdateLocation",addTitle:$("#location-name").val(),updateTitle:$("#update-location-name").val()};break;default:i.raiseError(new Error(i.undefinedError))}"Save"===$(this).closest(".modal-content").children(".modal-footer").children(".btn-save").text()?$("#confirm-modal-title").text("Add "+t.addTitle):"Update"===$(this).closest(".modal-content").children(".modal-footer").children(".btn-save").text()&&$("#confirm-modal-title").text("Update "+t.updateTitle),$("#confirm-yes").attr("data-action",t.action),$($(this).closest(".modal")).modal("hide"),$("#confirmModal").modal("show")}),$("#errorModal").on("click",".fkPopover",function(){$.ajax({type:"POST",url:"resources/php/getFKRecords.php",data:{id:$(this).attr("data-id"),table:$(this).attr("data-table")},dataType:"json",success:function(e){"OK"==e.status.name?($(".fkPopover").attr("data-bs-content",e.data.attached.join("<br>")),$(".fkPopover").popover({html:!0}),$(".fkPopover").popover("show")):i.raiseError(e)},error:function(e){i.raiseError(new Error(i.getFKRecordsError))}})}),$("#maintenance-nav").on("shown.bs.collapse",function(){$(".navbar-toggler-icon").addClass("navbar-expanded")}).on("hidden.bs.collapse",function(){$(".navbar-toggler-icon").removeClass("navbar-expanded")}),$("#maintenance-nav").on("show.bs.collapse",function(){$(".navbar-toggler-icon").addClass("rotate")}).on("hide.bs.collapse",function(){$(".navbar-toggler-icon").removeClass("rotate")}),$(".nav-link").on("click",function(e){var t=this,a={};switch(e.preventDefault(),$(this).attr("id")){case"personnel-nav-link":a={action:"getAll",errorType:"getAllError",table:$("#personnel-table-wrapper")};break;case"departments-nav-link":a={action:"getAllDepartments",errorType:"getAllDepartmentsError",table:$("#departments-table-wrapper")};break;case"locations-nav-link":a={action:"getAllLocations",errorType:"getAllLocationsError",table:$("#locations-table-wrapper")};break;default:i.raiseError(new Error(i.undefinedError))}l({action:a.action,errorType:a.errorType}).then(function(e){"getAllDepartments"===a.action?o(e):"getAllLocations"===a.action&&s(e),$(".modal").modal("hide"),$("#search-personnel-form")[0].reset(),$("#maintenance-nav").find(".active").removeClass("active"),$(t).addClass("active"),c(a.table),$(".navbar-collapse").collapse("hide")}).catch(function(e){i.raiseError(e)})}),$("#personnel-department").on("change",function(){$("#personnel-location").val($.parseHTML($("option:selected",this).attr("data-location"))[0].textContent)}),$("#search-personnel-form").on("submit",function(e){e.preventDefault(),l({action:"searchAllPersonnel",errorType:"searchAllPersonnelError",data:{search:$("#personnel-search-input").val()}}).catch(function(e){i.raiseError(e)})}),$("#personnel-refresh-button").on("click",function(){l({action:"getAll",errorType:"getAllError"}).then(function(){$(".tooltip").tooltip("hide"),$("#search-personnel-form")[0].reset()}).catch(function(e){i.raiseError(e)})}),$("#confirmModal").on("show.bs.modal",function(){$("#confirm-yes").removeClass("disabled")}),$("#confirmModal").on("hidden.bs.modal",function(){$("#confirm-no").add("#confirm-close").removeAttr("data-bs-toggle").removeAttr("data-bs-target"),$("#confirm-yes").removeAttr("data-action").removeAttr("data-id"),$("#confirm-modal-title").text("Confirm")}),$("#confirm-yes").on("click",function(){switch($("#confirm-yes").addClass("disabled"),$("#confirm-yes").attr("data-action")){case"insertUpdatePersonnel":l({action:"insertUpdatePersonnel",errorType:"insertUpdatePersonnelError",data:{id:$("#update-personnel-id").val(),firstName:$("#personnel-first-name").val(),lastName:$("#personnel-last-name").val(),jobTitle:$("#personnel-job-title").val(),email:$("#personnel-email").val(),departmentID:$("#personnel-department").val()}}).catch(function(e){i.raiseError(e)});break;case"insertUpdateDepartment":l({action:"insertUpdateDepartment",errorType:"insertUpdateDepartmentError",data:{id:$("#update-department-id").val(),name:$("#department-name").val(),locationID:$("#department-location").val()}}).catch(function(e){i.raiseError(e)});break;case"insertUpdateLocation":l({action:"insertUpdateLocation",errorType:"insertUpdateLocationError",data:{id:$("#update-location-id").val(),name:$("#location-name").val()}}).catch(function(e){i.raiseError(e)});break;case"deletePersonnelByID":case"deleteDepartmentByID":case"deleteLocationByID":l({action:$("#confirm-yes").attr("data-action"),errorType:$("#confirm-yes").attr("data-action")+"Error",data:{id:$("#confirm-yes").attr("data-id")}}).catch(function(e){i.raiseError(e)});break;default:i.raiseError(new Error(i.undefinedError))}}),l({action:"getAll",errorType:"getAllError"}).catch(function(e){i.raiseError(e)})});